## 前端性能相关

### 误区
常规情况下我们总会讨论性能的细节问题，例如某段代码的执行速度，但是从宏观项目来看，性能优化绝不能只局限于局部代码。真正有价值的优化，必定是从端到端的业务场景简历体系来考虑的。

### 性能体系
* 现状评估和建立指标
* 技术方案
* 执行
* 结果评估和监控

#### 现状和建立指标
工程角度：
1. 对用户而言，什么样的性能指标能更好评估它的体验？
2. 对公司来说，什么样的指标会影响业务价值？

性能方面，最重要的几个点：
* 页面加载性能；
* 动画与操作性能；
* 内存、电量消耗。

##### 页面加载性能
按照常规思维我们可能会关注的指标--“用户平均加载时间”，但是此指标有如下问题：
1. 当加载时间低于一定数值，用户体感差别不大，这个数字大约是1s
2. 少数超长时间加载的用户，会严重影响这个指标

基于以上考虑，可以得出一个新指标--秒开率，即一秒内打开的用户占用户总量的百分比。可以作为我们对页面加载性能的衡量。

#### 技术方案
以加载过程为例：
输入url到按下回车：

* 从域名到ip地址，需要DNS协议查询
* HTTP协议是用TCP传输的，所以会有TCP建立连接过程
* 如果使用HTTPS，还有HTTPS交换证书
* 每个网页还有图片等请求

从以上过程我们可以划分：

从上图可以看出，一个相对完善的优化方案不能局限在前端视角，必须从整体业务考虑，有服务端、客户端、设计师团队一起配合才能有良好的效果。

#### 执行
执行优化方案的过程可以从公司角度考虑，按照工程水平可划分为：
* 纯管理
* 制度化
* 自动化

我们应当去以自动化为目标执行优化，例如配合测试团队产出性能测试工具来保障自动化实施。目前多数公司都会采用制度化和自动化结合的执行方案。

#### 结果评估和监控
从工程角度来说，工程实施需要有一定的长效机制，从前端角度来说应该有适当的线上监控机制。

常规的线上监控分为：
1. 数据采集
2. 数据展现

数据采集部分需要发布平台或者开发工具来配合，对性能数据来说，Performance API可以有效记录浏览器的性能数据，一般来说，我们用统一的代码把它上传到服务端就够用了。

数据展现部分可以用不同的数据可视化方案来展现性能数据。同时要注意建立报警机制，可以设置条件对秒开率特别低的网页报警。

有了监控再配合制度和工具可以保障整个团队的产出性能，但是性能优化是个持续过程，技术方案也会更新迭代，制度和自动化工具也需要不断改进，最终的监控平台也不能不做新需求，性能应该成为团队日常工作的一部分持续进行。
