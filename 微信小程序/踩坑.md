
### 踩坑

#### 原生组件的层级问题

因为原生组件层级高于定位的z-index，所以当我们使用常规手段（wx:if wx:show）切换组件状态时，会出现奇怪的bug，这种情况下可以切换组件透明度opacity解决问题。还可以通过定位解决。

#### 设置顶部自定义导航

1. 用法

官方目前支持单页面设置和全局设置，但是单页面设置需要微信7.0.0+版本，而且兼容性存在问题，目前推荐全局设置，在所有需要的页面引入自定义导航的组件。

2. 样式和高度

自定义导航的样式和高度可以自主设置，推荐设置为：获取机型navbar高度 * 2 + 20，并在存储在storage中方便全局获取。还有以下需注意：

* 自定义导航往往使用fixed定位，所以最好在导航位置添加占位元素。
* 在需要计算容器高度的页面，推荐页面load时重新计算一次 navbar 高度，以防止storage中未存储或者未获取到该字段导致页面交互错乱。
* 右上角胶囊不支持自定义样式但是可以通过 navigationBarTextStyle 字段来设置字体颜色，支持 black / white，胶囊的背景色也会随之改变。

#### 样式相关

许多元素如 button 有自带样式如 padding 和 border, 使用时需重置掉。

#### 输入法与输入框

输入法自适应输入框：通常情况下只要给input 的 focus 绑定事件就可以方便的获取输入法高度调整样式。但有原生组件（如地图）的情况下，地图可能会遮盖掉上滑的样式，此时通过改变地图高度解决问题。

#### 地图相关

地图为原生组件

地图变化事件 regionChanged 捕捉到的 event 需要特别注意的是事件阶段字段(type)和触发类型(causedBy):

* type 分为 begin 和 end
* causedBy 分为 drag scale update
* 地图加载会触发的是 update
* 一次地图操作（比如拖拽）中，event会触发多次，每次都会有对应的 type 和 causedBy，注意二者的结合使用

#### showToast 和 showMetal

#### 登录

登录流程，登录获取code给服务端然后再发送code给服务端，服务端使用code去拼接从腾讯服务器获取用户敏感信息。

登录失效 checkSession 与服务端相关，不要在短期内进行多次登录获取code，不然会一直验证不通过。

#### 运行机制

视图渲染层和逻辑层

视图渲染层分两种：

ios 基于 webview

安卓 基于 chrome 开发的自主浏览器

#### storage

ios 2.5m 安卓 2.5-5m

storage存取非异步，会阻塞ui渲染
